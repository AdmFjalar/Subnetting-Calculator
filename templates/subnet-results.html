{% extends "main.html" %}
{% block content_block%}
    <div class="main container block">
      <div class="block">
        <p>To get started, enter the block of IP addresses you want to subnet. First enter the network ID and then it's CIDR notation, eg 192.168.0.0/24</p>
      </div>
      <div class="container">
        <form action="{{ url_for('generate_url') }}" method="post">
            <div class="input-group">
                <input readonly type="text" value="{{ base_ip }}" id="base_ip" name="base_ip" required>
                <h1 class="ip-cidr-slash">/</h1>
                <input readonly type="number" value="{{ base_cidr }}" id="base_cidr" min="1" max="30" name="base_cidr" required> 
            </div>
            <div class="input-group input-text-line">
                <label class="network-label" for="base_ip">Network Address</label> 
                <label class="cidr-label" for="base_cidr">CIDR</label>   
            </div>
           
        </form>
      </div>
  </div> 
  <div class="block">
    <div class="container">
    <p>
      You have entered a /{{base_cidr}} block of IPs. This means {{base_cidr}} bits of the IP address are reserved for 
      the network ID and {{32 - base_cidr|int()}} remaining bits can be used for host IDs. 
      </p>
      </div>
      <div class="container">
      <p>
      {{32 - base_cidr|int()}} bits of host address means your block of IPs has room for 2^{{32 - base_cidr|int()}} unique addresses. That's  
      {{2**(32 - base_cidr|int())}} unique addresses, which starts at {{base_ip}} and ends and {{base_broadcast}}. Start creating subnets in the box below.
    </p>
    </div>
</div> 
<div class="input_subnet">
  <h1>Create Subnet</h1>
  <h3>
    Enter the number of hosts you require in this subnet:
  </h3>
  <form action="{{ url_for('generate_url') }}" method="post">
        <input type="hidden" value="{{ base_ip }}" id="base_ip" name="base_ip" required>
        <input type="hidden" value="{{ base_cidr }}" id="base_cidr" name="base_cidr">
        <input type="hidden" value="{{ actual_hosts|join('-') }}" id="hosts_per_subnet" name="hosts_per_subnet">
    <fieldset>   
        <input type="number" min="2" max="{{ 2**(32-cidrAvailable) }}" id="hosts" name="hosts" required>
        <label class="hosts-label" for="hosts">Number of Hosts</label> 
    </fieldset> 

    <input class="submit" type="submit" value="Generate Subnet">
  </form>
</div>
  <div class="main container chart">
    <div id="BarChart"></div>
  </div>
  <div class="main container outputs">
      <div class="table container">
        <h3>Created Subnets</h3>
        <table >
            <tr>
              <th>Subnet Number</th> 
              <th>Network ID</th>
              <th>CIDR</th>  
              <th>Total Addresses</th>  
              <th>Usable Hosts</th>
              <th>Subnet Mask</th>
              <th>First IP (Gateway)</th>
              <th>Broadcast IP</th>     
            </tr>    
            {% for i in range (numberOfSubnets) %}
            <tr style="background-color: {{ subnetColors[i] }}">
              <td>{{ i + 1 }}</td> 
              <td>{{ generatedSubnets[i].network_address }}</td>    
              <td>{{ generatedSubnets[i].prefixlen }}</td> 
              <td>{{ 2 ** (32 - generatedSubnets[i].prefixlen) }}</td>
              <td>{{ (2 ** (32 - generatedSubnets[i].prefixlen)) - 2 }}</td>
              <td>{{ generatedSubnets[i].netmask }}</td>        
              <td>{{ generatedSubnets[i].network_address + 1 }}</td>        
              <td>{{ generatedSubnets[i].broadcast_address}}</td>        
            </tr>    
            {% endfor %}         
          </table>
    </div>
    <div class="table container">
      <h3>Total amount of addresses left: {{ addressesLeft }}</h3>
      <table style="background: white;">
        <tr>
          <th>CIDR Notation</th> 
          <th>Total addresses</th>
          <th>Usable addresses</th>       
        </tr>    
        {% for i in range (cidrAvailable, 31) %}
        <tr>
          <td>/{{ i }}</td> 
          <td>{{ 2** (32-i) }}</td>    
          <td>{{ (2** (32-i)) - 2 }}</td> 
        </tr>    
        {% endfor %}         
      </table>
    </div>

  </div>  
  {% endblock %}


  {% block js_block%}
    <script src="https://cdn.jsdelivr.net/npm/chartist@1.3.0/dist/index.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/patternomaly@1.3.2/dist/patternomaly.min.js"></script>

    <script>
        var hostsPerSubnet = {{ hostsPerSubnet | tojson }};
        hostsPerSubnet.push({{ addressesLeft }}); //  ADDS THE ADDRESS-SPACE LEFT

        var subnetColors = {{ subnetColors | tojson }};
        subnetColors.push('#d3d3d3');             //  ADDS A LIGHT GRAY FOR THE ADDRESS-SPACE LEFT

        var myChart = new Chartist.BarChart(
        '#BarChart',
        {
        series: hostsPerSubnet,
        backgroundColor: subnetColors,
      },
      {
        horizontalBars: true,
        stackBars: true,
        axisX: {
          showLabel: false,
          showGrid: false
        },
        axisY: {
          showLabel: false,
          showGrid: false
        },
        barWidth: 50, // Adjust the thickness of the bars
      }
    );

    myChart.on('draw', function(data) {
      if (data.type === 'bar' && data.seriesIndex !== undefined) {
 
        var seriesIndex = data.seriesIndex;
        var currentSeries = myChart.data.series[seriesIndex];

        data.element._node.style.stroke = subnetColors[seriesIndex].toString();
        data.element._node.style.fill = subnetColors[seriesIndex].toString();

        if (subnetColors[seriesIndex].toString() === "#d3d3d3") {
          data.element._node.classList.add('ct-bar-last');
        }
      }
    });

    </script>

{% endblock %}